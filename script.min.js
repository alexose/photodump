(()=>{const e="https://photodump-aws.s3.amazonaws.com";let n=document.location.hash;window.addEventListener("hashchange",()=>n=document.location.hash,!1);var t,o=window.location;t="https:"===o.protocol?"wss:":"ws:",t+="//"+o.host;const a=new WebSocket(t),i={list:({data:e})=>m(e),add:({data:e})=>m(e),progress:e=>(function({name:e,complete:n}){document.getElementById(e).children[0].style.width=100-n+"%",100===n&&h(e)})(e),welcome:({url:e})=>(function(e){window.location.hash="#"+e;const n=document.createElement("div");n.className=n.id="welcome",n.innerHTML='\n        <div class="welcome-inner">\n            <h1>Welcome to Photodump!</h1>\n            <p>\n                Photodump is the fastest and easiest way to share photos with friends.\n            </p> \n            <p>\n                Drag and drop your photos, or <a href="#">click here to upload</a>.\n            </p>\n        </div>\n    ',n.onclick=(e=>{const n=document.createElement("input");n.type="file",n.multiple=!0,n.onchange=(e=>{d(n.files)}),n.click()}),["dragover","drop","dragleave"].forEach(e=>{n.addEventListener(e,n=>s(e,n))}),c.before(n)})(e)};a.onopen=(()=>a.send(JSON.stringify({command:"list",hash:n}))),a.onmessage=(({data:e})=>{const n=JSON.parse(e),{command:t}=n;i[t]&&i[t](n),console.log(n)});const c=document.getElementById("application"),r=document.createElement("canvas");function s(e,n){n.preventDefault(),n.stopPropagation(),"drop"===e&&d(n.dataTransfer.files)}function d(e){const t={},o=Array.from(e);function a(){!function e(a){const i=o[a];i?l(i,2e3,2e3,o=>{!function(e,t,o){const a=Math.ceil(e.length/102400);!function i(c){const r=e.slice(c,c+102400);r.length?u(JSON.stringify({command:"upload_chunk",name:t,hash:n,total:a,chunk:r}),()=>{i(c+=102400)}):o()}(0)}(o.split(",")[1],t[a].name,()=>{e(a+1)})}):console.log("Done!")}(0)}o.forEach((o,i)=>{l(o,450,450,c=>{if(t[i]={name:v(o.name+o.lastModified+c),src:c},Object.keys(t).length==e.length){Object.keys(t);!function e(o){var i,c,r;t[o]?(i="thumbnail",c=t[o],r=(()=>e(o+1)),u(JSON.stringify({command:"upload_"+i,hash:n,file:c}),function(e){if(0===e)"function"==typeof r&&r();else{const n=c.size-e,t=Math.round(100*n/c.size);console.log(t)}})):a()}(0)}})})}function l(e,n,t,o){var a=r.getContext("2d"),i=new Image;i.onload=function(){let e=n&&t?Math.min(n/i.width,t/i.height):1;r.width=i.width*e,r.height=i.height*e,a.drawImage(i,0,0,r.width,r.height);const c=r.toDataURL("image/webp");o(c)},i.src=URL.createObjectURL(e)}function u(e,n){if(a.send(e),null!=n)var t=setInterval(function(){a.bufferedAmount>0?n(a.bufferedAmount):(n(0),clearInterval(t))},100)}function m(e){const{name:t,url:o,complete:a,src:i}=e,r=document.getElementById("welcome");if(r&&r.remove(),!document.getElementById(t)){const e=document.createElement("div");n.split("#").join("");e.id=t,e.className="thumb";const o=document.createElement("div");o.className="shade",o.style.width=100-a+"%",e.appendChild(o);const r=document.createElement("img");r.src=i,r.style.opacity=0,e.appendChild(r),c.appendChild(e),100===a&&h(t),setTimeout(()=>{r.style.opacity=1},10)}}function h(t){const o=document.createElement("img"),a=n.split("#").join("");o.id="full-"+t,o.src=`${e}/${a}/${t}.webp`,o.className="full",o.style.display="none",f.images.modal.appendChild(o);const i=document.getElementById(t);i&&(i.onclick=(e=>y(e,t)))}function p(e,n,t){const o=document.createElement("button");return o.className="button "+e,o.onclick=t,o.insertAdjacentHTML("beforeEnd",`<div>${n}</div>`),o}["dragover","drop","dragleave"].forEach(e=>{c.addEventListener(e,n=>s(e,n))}),c.after(p("help","?",function(e){!function(e,n,t="main"){e.stopPropagation();const o=f[t];n&&(o.modal.innerHTML="",o.modal.insertAdjacentHTML("beforeEnd",n));o.curtain.style.display="block"}(e,"\n        <div class=\"help-screen\">\n            <p>\n                Photodump is an experimental photo sharing service built for speed and ease-of-use.  It's intended for groups\n                of friends to share images with each other without needing to download annoying apps or needing to 'sign in'.\n            </p>\n            <p>\n                To get started, just click the arrow in the upper right corner.  Choose as many images as you like, then\n                press \"OK\".  You can also drag and drop images, if you like.\n            </p>\n            <p>\n                Photodump is designed to protect your privacy.  All metadata (including the date, location, and filename) \n                is stripped from the image before it's uploaded, and search engines are not permitted to crawl any submitted \n                data.  Individual Photodumps are automatically destroyed 14 days after the first image is uploaded.  \n                However, it is important to remember that these images are publically availble by default.  Therefore, \n                we recommend you take care when posting images that include identifiable features. \n            </p>\n            <p>\n                At this point, we do not offer any promises as to data availability or longevity.  Things might break,\n                disappear, or otherwise stop working without notice.\n            </p>\n            <p>\n                (c) 2020 Alexander Ose\n            </p>\n        </div>\n    ")}));const f={};function g(e){const n=f[e]={};n.curtain=document.createElement("div"),n.curtain.className="curtain",n.curtain.style.display="none",n.curtain.onclick=(e=>{n.curtain.style.display="none"}),n.modal=document.createElement("div"),n.modal.className="modal "+e,n.curtain.appendChild(n.modal),c.after(n.curtain)}function y(e,n){e.stopPropagation();const t=f.images;t.current&&(t.current.style.display="none");const o=document.getElementById("full-"+n);o.style.display="block",t.curtain.style.display="block",t.current=o}function v(e){var n="0123456789abcdef";function t(e){var t,o="";for(t=0;t<=3;t++)o+=n.charAt(e>>8*t+4&15)+n.charAt(e>>8*t&15);return o}function o(e,n){var t=(65535&e)+(65535&n);return(e>>16)+(n>>16)+(t>>16)<<16|65535&t}function a(e,n,t,a,i,c){return o((r=o(o(n,e),o(a,c)))<<(s=i)|r>>>32-s,t);var r,s}function i(e,n,t,o,i,c,r){return a(n&t|~n&o,e,n,i,c,r)}function c(e,n,t,o,i,c,r){return a(n&o|t&~o,e,n,i,c,r)}function r(e,n,t,o,i,c,r){return a(n^t^o,e,n,i,c,r)}function s(e,n,t,o,i,c,r){return a(t^(n|~o),e,n,i,c,r)}var d,l,u,m,h,p=function(e){var n,t=1+(e.length+8>>6),o=new Array(16*t);for(n=0;n<16*t;n++)o[n]=0;for(n=0;n<e.length;n++)o[n>>2]|=e.charCodeAt(n)<<n%4*8;return o[n>>2]|=128<<n%4*8,o[16*t-2]=8*e.length,o}(e),f=1732584193,g=-271733879,y=-1732584194,v=271733878;for(d=0;d<p.length;d+=16)l=f,u=g,m=y,h=v,f=i(f,g,y,v,p[d+0],7,-680876936),v=i(v,f,g,y,p[d+1],12,-389564586),y=i(y,v,f,g,p[d+2],17,606105819),g=i(g,y,v,f,p[d+3],22,-1044525330),f=i(f,g,y,v,p[d+4],7,-176418897),v=i(v,f,g,y,p[d+5],12,1200080426),y=i(y,v,f,g,p[d+6],17,-1473231341),g=i(g,y,v,f,p[d+7],22,-45705983),f=i(f,g,y,v,p[d+8],7,1770035416),v=i(v,f,g,y,p[d+9],12,-1958414417),y=i(y,v,f,g,p[d+10],17,-42063),g=i(g,y,v,f,p[d+11],22,-1990404162),f=i(f,g,y,v,p[d+12],7,1804603682),v=i(v,f,g,y,p[d+13],12,-40341101),y=i(y,v,f,g,p[d+14],17,-1502002290),f=c(f,g=i(g,y,v,f,p[d+15],22,1236535329),y,v,p[d+1],5,-165796510),v=c(v,f,g,y,p[d+6],9,-1069501632),y=c(y,v,f,g,p[d+11],14,643717713),g=c(g,y,v,f,p[d+0],20,-373897302),f=c(f,g,y,v,p[d+5],5,-701558691),v=c(v,f,g,y,p[d+10],9,38016083),y=c(y,v,f,g,p[d+15],14,-660478335),g=c(g,y,v,f,p[d+4],20,-405537848),f=c(f,g,y,v,p[d+9],5,568446438),v=c(v,f,g,y,p[d+14],9,-1019803690),y=c(y,v,f,g,p[d+3],14,-187363961),g=c(g,y,v,f,p[d+8],20,1163531501),f=c(f,g,y,v,p[d+13],5,-1444681467),v=c(v,f,g,y,p[d+2],9,-51403784),y=c(y,v,f,g,p[d+7],14,1735328473),f=r(f,g=c(g,y,v,f,p[d+12],20,-1926607734),y,v,p[d+5],4,-378558),v=r(v,f,g,y,p[d+8],11,-2022574463),y=r(y,v,f,g,p[d+11],16,1839030562),g=r(g,y,v,f,p[d+14],23,-35309556),f=r(f,g,y,v,p[d+1],4,-1530992060),v=r(v,f,g,y,p[d+4],11,1272893353),y=r(y,v,f,g,p[d+7],16,-155497632),g=r(g,y,v,f,p[d+10],23,-1094730640),f=r(f,g,y,v,p[d+13],4,681279174),v=r(v,f,g,y,p[d+0],11,-358537222),y=r(y,v,f,g,p[d+3],16,-722521979),g=r(g,y,v,f,p[d+6],23,76029189),f=r(f,g,y,v,p[d+9],4,-640364487),v=r(v,f,g,y,p[d+12],11,-421815835),y=r(y,v,f,g,p[d+15],16,530742520),f=s(f,g=r(g,y,v,f,p[d+2],23,-995338651),y,v,p[d+0],6,-198630844),v=s(v,f,g,y,p[d+7],10,1126891415),y=s(y,v,f,g,p[d+14],15,-1416354905),g=s(g,y,v,f,p[d+5],21,-57434055),f=s(f,g,y,v,p[d+12],6,1700485571),v=s(v,f,g,y,p[d+3],10,-1894986606),y=s(y,v,f,g,p[d+10],15,-1051523),g=s(g,y,v,f,p[d+1],21,-2054922799),f=s(f,g,y,v,p[d+8],6,1873313359),v=s(v,f,g,y,p[d+15],10,-30611744),y=s(y,v,f,g,p[d+6],15,-1560198380),g=s(g,y,v,f,p[d+13],21,1309151649),f=s(f,g,y,v,p[d+4],6,-145523070),v=s(v,f,g,y,p[d+11],10,-1120210379),y=s(y,v,f,g,p[d+2],15,718787259),g=s(g,y,v,f,p[d+9],21,-343485551),f=o(f,l),g=o(g,u),y=o(y,m),v=o(v,h);return t(f)+t(g)+t(y)+t(v)}g("main"),g("images"),[["previous","«"],["next","»"]].forEach(([e,n])=>{f.images.modal.after(p(e,n,n=>{const t=f.images.current[e+"Sibling"];if(t){y(n,t.id.split("full-").join(""))}}))})})();

